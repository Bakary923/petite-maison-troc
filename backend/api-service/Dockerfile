# Image Node l√©g√®re pour optimiser le temps de build et la s√©curit√©
FROM node:18-alpine

# D√©finition du dossier de travail
WORKDIR /app

# Installation des d√©pendances (production uniquement pour r√©duire la taille de l'image)
COPY package*.json ./
RUN npm install --only=production

# Copie du code source dans le conteneur
COPY . .

# ‚úÖ S√âCURIT√â OPENSHIFT : Cr√©ation d'un utilisateur non-root (UID 1001)
# OpenShift interdit l'ex√©cution en tant que 'root' par s√©curit√©.
RUN adduser -D -u 1001 appuser

# üìÅ SUPPRESSION DE LA LOGIQUE UPLOADS LOCALE
# Nous ne cr√©ons plus de dossier 'uploads' ici car l'application est Stateless.
# Les images transitent par la RAM (Multer memoryStorage) vers le Cloud.

# Changement de propri√©taire pour tout le dossier app
RUN chown -R 1001:1001 /app

# Ex√©cution en utilisateur non-root pour respecter le principe du moindre privil√®ge
USER 1001

# Port d‚Äô√©coute de l‚ÄôAPI (coh√©rent avec values.yaml et deployment.yaml)
EXPOSE 3000

# Commande de d√©marrage
CMD ["node", "src/app.js"]