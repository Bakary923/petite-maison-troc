# ============================================================
# VALUES.YAML - PETITE MAISON DU TROC (MODE HYBRIDE)
# ============================================================
# Ce fichier contient la configuration générale du chart Helm.
# Les secrets sensibles (mots de passe, clés JWT) doivent rester
# dans values-secrets.yaml ou être injectés via --set dans la CD.
# ============================================================


# --- 1. CONFIGURATION DE LA PLATEFORME ---
# true  = OpenShift (utilise Route)
# false = Minikube / Kubernetes standard (utilise Ingress)
openshift:
  enabled: true


# --- 2. SECRETS & SÉCURITÉ ---
# Ces valeurs sont des placeholders. Les vraies valeurs viennent
# de values-secrets.yaml ou de la pipeline GitHub Actions.
secrets:
  dbName: "REDACTED"
  dbUser: "REDACTED"
  dbPassword: "REDACTED"
  jwtSecret: "REDACTED"
  jwtRefreshSecret: "REDACTED"


# --- 3. BACKEND (API) ---
backend:
  image:
    repository: ghcr.io/bakary923/petite-maison-troc/backend   # Image backend
    tag: latest                                                # Tag déployé
    pullPolicy: Always                                         # Toujours pull la dernière image

  replicaCount: 1                                              # Nombre de pods backend
  containerPort: 3000                                          # Port interne du conteneur
  servicePort: 3000                                            # Port exposé dans le Service
  serviceType: ClusterIP                                       # Service interne au cluster

  # URL utilisée par le frontend pour appeler l’API
  url: "http://petite-maison.local/api"


# --- 4. FRONTEND (WEB) ---
frontend:
  image:
    repository: ghcr.io/bakary923/petite-maison-troc/frontend  # Image frontend
    tag: latest
    pullPolicy: Always

  replicaCount: 1
  containerPort: 80
  servicePort: 80
  serviceType: ClusterIP

  # URL publique du site (utilisée pour les redirections, SEO, etc.)
  url: "http://petite-maison.local"


# --- 5. BASE DE DONNÉES (SUPABASE) ---
# ⚠️ L’ancienne configuration Postgres interne est supprimée.
# Supabase fournit la base de données, donc plus de :
# - Deployment Postgres
# - Service Postgres
# - PVC Postgres
#
# On ne garde que les infos nécessaires pour injecter l’hôte Supabase.
database:
  host: "{{ .Values.secrets.dbHost }}"   # Hôte Supabase (ex: db.xxxxx.supabase.co)
  port: 5432                             # Port PostgreSQL Supabase


# --- 6. STOCKAGE PERSISTANT (UPLOADS) ---
# Ce PVC reste nécessaire car Supabase ne gère pas tes fichiers uploads.
storage:
  pvcName: "uploads-pvc"                 # Nom du PVC pour les uploads
  uploadsSize: 1Gi                       # Taille du volume
  accessMode: ReadWriteOnce              # Mode d’accès


# --- 7. INGRESS (Minikube / Standard K8s) ---
# Désactivé sur OpenShift car la Route prend le relais.
ingress:
  enabled: false
  className: "nginx"
  host: "petite-maison.local"
